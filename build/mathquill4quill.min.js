"use strict";function ownKeys(e,t){var n,l=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),l.push.apply(l,n)),l}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}window.mathquill4quill=function(t){var E=(t=t||{}).Quill||window.Quill,_=t.MathQuill||window.MathQuill,x=t.katex||window.katex,C=t.localStorage||window.localStorage;function A(t){try{return C.getItem(t)}catch(t){return""}}return function(n){var e,r,o,i,u,l,a,c,s,d,f,m,p,h,y,b,g,w,v=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{syncInput:!1};function q(){return n.container.getElementsByClassName("ql-tooltip")[0]}function O(){return q().getElementsByTagName("input")[0]}function j(n,t){var e=null==c.handlers?{}:c.handlers,l=(c.handlers=_objectSpread(_objectSpread({},e),{},{edit:function(){var t=l.latex(),e=(n.value=t,s);try{C.setItem(e,t)}catch(t){}},enter:function(){t.click()}}),_.getInterface(2).MathField(d,c));return v.syncInput||(e=A(s))&&l.latex(e),t.addEventListener("click",function(){var t=s;if((t=A(t))&&0<t.length){var e=o.indexOf(t);-1!=e&&o.splice(e,1),o.unshift(t),o.length>i&&o.pop();try{C.setItem(r,JSON.stringify(o))}catch(t){}}e=s;try{C.removeItem(e)}catch(t){}}),l}!function(){if(E)if(_)if(x)if(n.options.modules.formula){if(MutationObserver)return 1;console.log("MutationObserver not defined")}else console.log("Formula module not enabled");else console.log("katex.js not loaded");else console.log("MathQuill.js not loaded");else console.log("Quill.js not loaded")}()||(e=q(),r=v.historyCacheKey||"__mathquill4quill_historylist_cache__",o=function(t){try{return JSON.parse(C.getItem(t))||[]}catch(t){return[]}}(r),i=v.historySize||10,u=v.displayHistory||!1,a=null==v.autofocus||v.autofocus,c=null!=v.mathQuillConfig?v.mathQuillConfig:{},s=v.cacheKey||"__mathquill4quill_cache__",m=f=d=null,l={render:function(){var t,e,n;return null==d&&(t=O(),n=q().getElementsByClassName("ql-action")[0],(d=document.createElement("span")).setAttribute("class","mathquill4quill-mathquill-input"),m=t.className,t.setAttribute("class","mathquill4quill-latex-input"),f=j(t,n),e=f,a&&window.setTimeout(function(){return e.focus()},1),n=d,t.parentNode.insertBefore(n,t.nextSibling)),f},destroy:function(){null!=d&&(O().setAttribute("class",m),d.remove(),d=null)}},h=v.operators||[],p={render:function(r){var t;null==y&&0!==h.length&&(t=q(),(y=document.createElement("div")).setAttribute("class","mathquill4quill-operator-container"),h.forEach(function(t){e=r,l=(t=t)[0],n=t[1],(t=document.createElement("button")).setAttribute("type","button"),t.setAttribute("data-value",n),x.render(l,t,{throwOnError:!1}),t.onclick=function(){/^\\[A-Za-z]+$/.test(n)?e.cmd(n):e.write(n),e.focus()};var e,n,l=t;l.setAttribute("class","mathquill4quill-operator-button"),y.appendChild(l)}),t.appendChild(y))},destroy:function(){null!=y&&(y.remove(),y=null)}},g=o||[],w=y=null,b={render:function(l){var t,r,e;(t=q()).getBoundingClientRect().top-n.container.getBoundingClientRect().top<0&&(t.style.top="0px"),null==w&&u&&0!==g.length&&(t=q(),w=document.createElement("div"),(r=document.createElement("div")).setAttribute("class","mathquill4quill-history-container"),(e=document.createElement("p")).innerHTML="Past formulas (max "+i+")",w.appendChild(e),g.forEach(function(t){e=t,n=l,(t=document.createElement("button")).setAttribute("type","button"),x.render(e,t,{throwOnError:!1}),t.onclick=function(){n.write(e),n.focus()};var e,n;t.setAttribute("class","mathquill4quill-history-button"),r.appendChild(t)}),w.appendChild(r),t.appendChild(w))},destroy:function(){null!=w&&(w.remove(),w=null)}},new MutationObserver(function(){var t;!e.classList.contains("ql-hidden")&&e.attributes["data-mode"]&&"formula"===e.attributes["data-mode"].value?(t=l.render(),v.syncInput&&t.latex(O().value),p.render(t),b.render(t)):(l.destroy(),p.destroy(),b.destroy())}).observe(e,{attributes:!0,attributeFilter:["class","data-mode"]}))}},"undefined"!=typeof module&&module.exports&&(module.exports=window.mathquill4quill),window.Quill&&(window.Quill.prototype.enableMathQuillFormulaAuthoring=function(t){window.mathquill4quill()(this,t)});
