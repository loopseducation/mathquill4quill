"use strict";function ownKeys(e,t){var n,l=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),l.push.apply(l,n)),l}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}window.mathquill4quill=function(t){var x=(t=t||{}).Quill||window.Quill,_=t.MathQuill||window.MathQuill,k=t.katex||window.katex,A=t.localStorage||window.localStorage;function C(t){try{return A.getItem(t)}catch(t){return""}}function P(t,e){e.parentNode.insertBefore(t,e.nextSibling)}return function(n){var e,r,o,i,u,l,a,c,s,d,m,f,p,h,b,y,w,g,v,q=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{syncInput:!1};function O(){return n.container.getElementsByClassName("ql-tooltip")[0]}function E(){return O().getElementsByTagName("input")[0]}function j(n,t){var e=null==c.handlers?{}:c.handlers,l=(c.handlers=_objectSpread(_objectSpread({},e),{},{edit:function(){var t=l.latex(),e=(n.value=t,s);try{A.setItem(e,t)}catch(t){}},enter:function(){t.click()}}),_.getInterface(2).MathField(d,c));return q.syncInput||(e=C(s))&&l.latex(e),t.addEventListener("click",function(){var t=s;if((t=C(t))&&0<t.length){var e=o.indexOf(t);-1!=e&&o.splice(e,1),o.unshift(t),o.length>i&&o.pop();try{A.setItem(r,JSON.stringify(o))}catch(t){}}e=s;try{A.removeItem(e)}catch(t){}}),l}!function(){if(x)if(_)if(k)if(n.options.modules.formula){if(MutationObserver)return 1;console.log("MutationObserver not defined")}else console.log("Formula module not enabled");else console.log("katex.js not loaded");else console.log("MathQuill.js not loaded");else console.log("Quill.js not loaded")}()||(e=O(),r=q.historyCacheKey||"__mathquill4quill_historylist_cache__",o=function(t){try{return JSON.parse(A.getItem(t))||[]}catch(t){return[]}}(r),i=q.historySize||10,u=q.displayHistory||!1,a=null==q.autofocus||q.autofocus,c=null!=q.mathQuillConfig?q.mathQuillConfig:{},s=q.cacheKey||"__mathquill4quill_cache__",p=f=m=d=null,l={render:function(){var t,e,n,l,r;return null==d&&(t=E(),r=O().getElementsByClassName("ql-action")[0],(d=document.createElement("span")).setAttribute("class","mathquill4quill-mathquill-input"),p=t.className,t.setAttribute("class","mathquill4quill-latex-input"),m=j(t,r),e=m,a&&window.setTimeout(function(){return e.focus()},1),q.katexLink&&(n=(r=q.katexLink).text,l=r.url,f=document.createElement("div"),(r=document.createElement("a")).innerHTML=n,r.setAttribute("href","#"),r.setAttribute("class","mathquill4quill-katex-support-document-link"),r.onclick=function(t){t.preventDefault(),window.open(l,"_blank","height=1024,width=720")},f.appendChild(r)),P(d,t),f)&&P(f,d),m},destroy:function(){null!=d&&(E().setAttribute("class",p),d.remove(),d=null,f)&&(f.remove(),f=null)}},b=q.operators||[],h={render:function(r){var t;null==y&&0!==b.length&&(t=O(),(y=document.createElement("div")).setAttribute("class","mathquill4quill-operator-container"),b.forEach(function(t){e=r,l=(t=t)[0],n=t[1],(t=document.createElement("button")).setAttribute("type","button"),t.setAttribute("data-value",n),k.render(l,t,{throwOnError:!1}),t.onclick=function(){/^\\[A-Za-z]+$/.test(n)?e.cmd(n):e.write(n),e.focus()};var e,n,l=t;l.setAttribute("class","mathquill4quill-operator-button"),y.appendChild(l)}),t.appendChild(y))},destroy:function(){null!=y&&(y.remove(),y=null)}},g=o||[],v=y=null,w={render:function(l){var t,r,e;(t=O()).getBoundingClientRect().top-n.container.getBoundingClientRect().top<0&&(t.style.top="0px"),null==v&&u&&0!==g.length&&(t=O(),v=document.createElement("div"),(r=document.createElement("div")).setAttribute("class","mathquill4quill-history-container"),(e=document.createElement("p")).innerHTML="Past formulas (max "+i+")",v.appendChild(e),g.forEach(function(t){e=t,n=l,(t=document.createElement("button")).setAttribute("type","button"),k.render(e,t,{throwOnError:!1}),t.onclick=function(){n.write(e),n.focus()};var e,n;t.setAttribute("class","mathquill4quill-history-button"),r.appendChild(t)}),v.appendChild(r),t.appendChild(v))},destroy:function(){null!=v&&(v.remove(),v=null)}},new MutationObserver(function(){var t;!e.classList.contains("ql-hidden")&&e.attributes["data-mode"]&&"formula"===e.attributes["data-mode"].value?(t=l.render(),q.syncInput&&t.latex(E().value),h.render(t),w.render(t)):(l.destroy(),h.destroy(),w.destroy())}).observe(e,{attributes:!0,attributeFilter:["class","data-mode"]}))}},"undefined"!=typeof module&&module.exports&&(module.exports=window.mathquill4quill),window.Quill&&(window.Quill.prototype.enableMathQuillFormulaAuthoring=function(t){window.mathquill4quill()(this,t)});
